<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarifas - Sistema Parqueadero</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .loading { text-align: center; padding: 20px; }
        .error { color: #dc3545; padding: 15px; background: #f8d7da; border-radius: 5px; margin: 10px 0; }
        .success { color: #28a745; padding: 15px; background: #d4edda; border-radius: 5px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; }
        table th { background: #007bff; color: white; padding: 12px; text-align: left; }
        table td { padding: 12px; border-bottom: 1px solid #ddd; }
        table tr:hover { background: #f8f9fa; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí≤ Tarifas Registradas</h1>
        
        <div id="message" style="display:none;"></div>
        <div id="debug" class="debug" style="display:none;"></div>
        <div id="loading" class="loading" style="display:none;">Cargando...</div>
        
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tipo de Veh√≠culo</th>
                    <th>Precio por Hora</th>
                    <th>Fecha Creaci√≥n</th>
                </tr>
            </thead>
            <tbody id="tarifasBody"></tbody>
        </table>

        <div style="margin-top: 20px;">
            <a href="index.html" class="btn btn-secondary">‚Üê Volver al Inicio</a>
            <a href="agregarTarifa.html" class="btn btn-primary">+ Agregar Tarifa</a>
        </div>
    </div>

    <script>
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('es-CO');
        }

        function showMessage(message, type = 'error') {
            const msgDiv = document.getElementById('message');
            msgDiv.className = type;
            msgDiv.textContent = message;
            msgDiv.style.display = 'block';
            setTimeout(() => msgDiv.style.display = 'none', 5000);
        }

        function showDebug(message) {
            const debugDiv = document.getElementById('debug');
            debugDiv.textContent = message;
            debugDiv.style.display = 'block';
        }

        async function cargarTarifas() {
            const loading = document.getElementById('loading');
            const tbody = document.getElementById('tarifasBody');
            
            loading.style.display = 'block';
            
            try {
                const url = '/SistemaParqueadero/api/tarifas';
                showDebug('Llamando a: ' + url);
                
                const response = await fetch(url);
                showDebug('Status: ' + response.status + ' | Content-Type: ' + response.headers.get('content-type'));
                
                const text = await response.text();
                showDebug('Respuesta cruda: ' + text.substring(0, 200));
                
                loading.style.display = 'none';
                
                if (!text || text.trim() === '') {
                    showMessage('El servidor devolvi√≥ una respuesta vac√≠a', 'error');
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:red;">Error: Respuesta vac√≠a del servidor</td></tr>';
                    return;
                }
                
                let result;
                try {
                    result = JSON.parse(text);
                } catch (e) {
                    showMessage('Error al parsear JSON: ' + e.message, 'error');
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:red;">Error: Respuesta no es JSON v√°lido</td></tr>';
                    return;
                }
                
                if (result.success) {
                    if (result.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No hay tarifas registradas</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = result.data.map(t => `
                        <tr>
                            <td>${t.id}</td>
                            <td><strong>${t.tipo}</strong></td>
                            <td>$${t.precioPorHora.toLocaleString('es-CO')}</td>
                            <td>${formatDate(t.creadoEn)}</td>
                        </tr>
                    `).join('');
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                loading.style.display = 'none';
                showMessage('Error al cargar tarifas: ' + error.message, 'error');
                showDebug('Error completo: ' + error.stack);
            }
        }

        document.addEventListener('DOMContentLoaded', cargarTarifas);
    </script>
</body>
</html>